<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Germanedge | DCE Learning Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <!-- Corporate CSS -->
    <link rel="stylesheet" href="css/germanedge.css?v=4">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* --- VISUAL UNIFICATION --- */
        :root {
            --ge-black: #050505;
            --ge-dark-grey: #111111;
            --ge-yellow: #FFD100;
        }

        body { background-color: #F3F4F6; }

        /* Dark Sidebar Scrollbar */
        .dark-scroll::-webkit-scrollbar { width: 6px; }
        .dark-scroll::-webkit-scrollbar-track { background: #111; }
        .dark-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .dark-scroll::-webkit-scrollbar-thumb:hover { background: #FFD100; }

        /* Card Grid */
        .card-grid {
            display: grid;
            gap: 1.5rem;
            padding: 0 2rem 2rem 2rem;
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        @media (min-width: 640px) { .card-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
        @media (min-width: 1024px) { .card-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        @media (min-width: 1280px) { .card-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
        @media (min-width: 1600px) { .card-grid { grid-template-columns: repeat(5, minmax(0, 1fr)); } }

        /* 3D Flip Card */
        .flashcard-scene {
            background-color: transparent;
            width: 100%;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .flashcard-scene.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .flashcard-front {
            background-color: white;
            color: #111;
            border: 1px solid #E5E7EB;
        }

        .flashcard-back {
            background-color: #111;
            color: white;
            transform: rotateY(180deg);
            border: 1px solid #333;
        }

        .flashcard-category {
            position: absolute;
            top: 1rem;
            left: 1rem;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #9CA3AF;
            font-weight: 700;
        }

        .flashcard-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #FFD100;
        }

        .flashcard-q {
            font-size: 1.1rem;
            font-weight: 700;
            line-height: 1.4;
        }

        .flashcard-a {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #E5E7EB;
        }

        /* Tag Styles */
        .card-tags {
            margin-top: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        .card-tag {
            background: #333;
            color: #FFD100;
            font-size: 0.6rem;
            padding: 2px 8px;
            border-radius: 99px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        /* Sidebar Module Button */
        .module-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 1rem;
            text-align: left;
            border-radius: 6px;
            transition: all 0.2s;
            margin-bottom: 0.5rem;
            cursor: pointer;
            color: #9CA3AF;
            border: 1px solid transparent;
        }
        
        .module-btn:hover { background-color: #222; color: white; }
        .module-btn.active { 
            background-color: #1A1A1A; 
            color: white; 
            border-color: #333;
            border-left: 3px solid #FFD100;
        }
        .module-btn.active .module-number { background-color: #FFD100; color: black; }

        .module-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #333;
            color: #999;
            font-size: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            transition: all 0.2s;
        }

        /* Tabs */
        .track-tab {
            padding-bottom: 1rem;
            margin-right: 2rem;
            font-weight: 700;
            font-size: 0.8rem;
            color: #6B7280;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .track-tab:hover { color: #111; }
        .track-tab.active { color: #000; border-bottom-color: #FFD100; }

        /* Badges */
        .badge-certified {
            display: inline-flex;
            align-items: center;
            background: #FFD100;
            color: black;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 800;
            margin-left: 8px;
            text-transform: uppercase;
            display: none;
        }
        
        /* Tag Cloud */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0 1.5rem 1.5rem 1.5rem;
        }
        .tag-pill {
            background-color: #222;
            color: #9CA3AF;
            font-size: 0.65rem;
            padding: 4px 10px;
            border-radius: 99px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .tag-pill:hover {
            background-color: #333;
            color: white;
            border-color: #555;
        }
        .tag-pill.active {
            background-color: #FFD100;
            color: black;
            font-weight: 700;
        }

        /* Dashboard */
        .dashboard-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 2rem;
            transition: all 0.3s;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            border-color: #FFD100;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }
        .dash-icon { font-size: 3rem; margin-bottom: 1rem; }
        .dash-title { font-weight: 800; font-size: 1.2rem; color: black; margin-bottom: 0.5rem; }
        .dash-desc { color: #6B7280; font-size: 0.9rem; }

        /* Modal Safe-Guard */
        #quiz-modal { transition: opacity 0.3s ease; }
        #quiz-modal.hidden { display: none !important; opacity: 0; pointer-events: none; }
        
        /* Sidebar Cards (NEW) */
        .sidebar-card {
            background-color: #111;
            border: 1px solid #333;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .sidebar-card:hover {
            background-color: #1A1A1A;
            border-color: #FFD100;
        }
        .sidebar-card-icon {
            font-size: 1.2rem;
        }
        .sidebar-card-text {
            color: #E5E7EB;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .sidebar-card:hover .sidebar-card-text {
            color: white;
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- NAVIGATION -->
    <nav class="fixed w-full z-[1000] bg-black h-20 flex-shrink-0 border-b border-white/10">
        <div class="max-w-full px-6 w-full h-full flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="./index.html" class="text-white text-2xl font-bold tracking-tight flex items-center gap-2 hover:text-ge-yellow transition">
                    <span class="text-3xl text-ge-yellow">‚àû</span> Germanedge
                </a>
                <div class="hidden md:block w-px h-6 bg-gray-700 mx-2"></div>
                <span class="hidden md:block text-gray-400 text-xs font-bold uppercase tracking-widest">Digital Factory Knowledge Hub</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="./index.html" class="text-xs font-bold text-white uppercase border border-gray-600 px-4 py-2 rounded hover:bg-white hover:text-black transition">Back to Strategy</a>
                
                <!-- AUTH CONTAINER -->
                <div class="auth-container">
                    <!-- Auth buttons injected by auth.js -->
                    <div class="text-gray-500 text-xs">Loading...</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN LAYOUT -->
    <div class="flex flex-1 pt-20 overflow-hidden">
        
        <!-- SIDEBAR (Dark Mode) -->
        <aside class="w-80 bg-[#050505] border-r border-white/10 overflow-y-auto hidden md:block flex-shrink-0 dark-scroll flex flex-col">
            <div class="p-6 pb-2">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest" id="sidebar-header">Modules</h3>
                    <div id="sidebar-badge" class="badge-certified">CERTIFIED</div>
                </div>
                <div id="module-list">
                    <!-- Modules injected here -->
                </div>
            </div>
            
            <!-- TAG CLOUD SECTION -->
            <div class="mt-4 px-6">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-3">Explore by Topic</h3>
                <div id="tag-cloud" class="flex flex-wrap gap-2">
                    <!-- Tags injected here -->
                </div>
            </div>

            <!-- LEARNING PATHS (New Sidebar Cards) -->
            <div class="mt-8 px-6">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-3">Quick Paths</h3>
                
                <div onclick="switchTrack('strategy')" class="sidebar-card">
                    <span class="sidebar-card-icon">üöÄ</span>
                    <span class="sidebar-card-text">The Rookie</span>
                </div>
                
                <div onclick="switchTrack('comp')" class="sidebar-card">
                    <span class="sidebar-card-icon">‚öîÔ∏è</span>
                    <span class="sidebar-card-text">The Deal Closer</span>
                </div>
                
                <div onclick="switchTrack('ai')" class="sidebar-card">
                    <span class="sidebar-card-icon">üßô</span>
                    <span class="sidebar-card-text">The Futurist</span>
                </div>

                <div onclick="switchTrack('intel')" class="sidebar-card">
                    <span class="sidebar-card-icon">üß†</span>
                    <span class="sidebar-card-text">The Expert</span>
                </div>
            </div>
            
            <!-- PROGRESS PANEL (populated by auth.js) -->
            <div id="sidebar-progress-panel" class="mt-6 px-6">
                <!-- Progress UI injected here when logged in -->
            </div>

            <div class="p-6 mt-auto border-t border-white/10 bg-[#0a0a0a]">
                <p class="text-xs font-bold text-white mb-1">PRO TIP</p>
                <p class="text-xs text-gray-500">Switch tabs above to change between Strategy, Intel and AI Adoption.</p>
            </div>
        </aside>

        <!-- CONTENT AREA -->
        <main class="flex-1 overflow-y-auto relative bg-[#F3F4F6] flex flex-col">
            
            <!-- TRACK TABS -->
            <div class="px-8 pt-8 pb-0 bg-white border-b border-gray-200 sticky top-0 z-20 shadow-sm flex justify-between items-end">
                <div class="flex flex-wrap gap-4 overflow-x-auto" id="track-tabs-container">
                    <button onclick="switchTrack('strategy')" id="tab-strategy" class="track-tab">
                        TRACK 1: STRATEGY <span id="badge-strategy" class="badge-certified">‚úì</span>
                    </button>
                    <button onclick="switchTrack('intel')" id="tab-intel" class="track-tab">
                        TRACK 2: INTEL <span id="badge-intel" class="badge-certified">‚úì</span>
                    </button>
                    <button onclick="switchTrack('ai')" id="tab-ai" class="track-tab">
                        TRACK 3: AI ADOPTION <span id="badge-ai" class="badge-certified">‚úì</span>
                    </button>
                    <button onclick="switchTrack('comp')" id="tab-comp" class="track-tab">
                        TRACK 4: COMPETITION <span id="badge-comp" class="badge-certified">‚úì</span>
                    </button>
                </div>
                
                <!-- Main Quiz Button -->
                <button onclick="openQuiz()" id="quiz-btn" class="hidden mb-3 bg-black text-white text-xs font-bold uppercase px-4 py-2 rounded hover:bg-ge-yellow hover:text-black transition flex items-center gap-2">
                    <span>üéì Take Exam</span>
                </button>
            </div>

            <!-- Mobile Select -->
            <div class="md:hidden p-4 bg-white border-b border-gray-200">
                <select id="mobile-select" class="w-full p-2 border border-gray-300 rounded font-bold text-sm" onchange="loadModule(this.value)">
                    <!-- Options injected here -->
                </select>
            </div>

            <!-- Module Header -->
            <div class="px-8 pt-8 pb-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h1 id="module-title" class="text-3xl font-bold text-black mb-2">Select a Module</h1>
                        <p id="module-desc" class="text-gray-500">Explore the strategic pillars of the Decision Centric Enterprise.</p>
                    </div>
                    <!-- Tag Filter Controls (Hidden by default) -->
                    <div id="filter-controls" class="hidden flex gap-2">
                        <!-- Buttons injected via JS -->
                    </div>
                </div>
            </div>

            <!-- CONTENT GRID -->
            <div id="card-grid" class="card-grid">
                <!-- Dashboard or Cards injected here -->
            </div>

            <div class="h-20"></div>
        </main>
    </div>

    <!-- QUIZ MODAL -->
    <div id="quiz-modal" class="fixed inset-0 z-[1100] bg-black/90 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4 overflow-hidden relative">
            <button onclick="closeQuiz()" class="absolute top-4 right-4 text-gray-400 hover:text-black font-bold">‚úï</button>
            
            <!-- Quiz Start State -->
            <div id="quiz-start" class="p-8 text-center">
                <div class="w-16 h-16 bg-ge-yellow rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">üéì</div>
                <h2 id="quiz-title-display" class="text-2xl font-bold mb-2">Track Certification Exam</h2>
                <p id="quiz-desc-display" class="text-gray-600 mb-6">Answer 3 questions correctly to earn your certification badge for this track.</p>
                <button onclick="startQuiz()" class="bg-black text-white font-bold py-3 px-8 rounded hover:bg-gray-800 transition">Start Quiz</button>
            </div>

            <!-- Quiz Questions State -->
            <div id="quiz-questions" class="p-8 hidden">
                <div class="flex justify-between items-center mb-6 border-b border-gray-100 pb-4">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">Question <span id="q-current">1</span> of <span id="q-total">3</span></span>
                    <span class="text-ge-yellow font-bold text-sm" id="quiz-track-name">STRATEGY</span>
                </div>
                <h3 id="question-text" class="text-xl font-bold mb-6">Question goes here?</h3>
                <div id="answers-container" class="space-y-3">
                    <!-- Buttons injected via JS -->
                </div>
            </div>

            <!-- Quiz Success State -->
            <div id="quiz-success" class="p-8 text-center hidden">
                <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl text-white">‚úì</div>
                <h2 class="text-2xl font-bold mb-2">Certified!</h2>
                <p class="text-gray-600 mb-6">You have mastered this topic.</p>
                <button onclick="closeQuiz()" class="bg-black text-white font-bold py-3 px-8 rounded hover:bg-gray-800 transition">Close & Save</button>
            </div>

            <!-- Quiz Fail State -->
            <div id="quiz-fail" class="p-8 text-center hidden">
                <div class="w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl text-white">‚úï</div>
                <h2 class="text-2xl font-bold mb-2">Not Quite...</h2>
                <p class="text-gray-600 mb-6">Review the flashcards and try again.</p>
                <button onclick="resetQuiz()" class="bg-gray-200 text-black font-bold py-3 px-8 rounded hover:bg-gray-300 transition">Try Again</button>
            </div>
        </div>
    </div>

    <!-- DATA & LOGIC -->
    <script>
        // --- COMPLETE MODULE DATASET WITH CONSOLIDATED TAGS ---
        const modules = [
            // TRACK 1: DCE STRATEGY
            {
                title: "1. Strategic Context",
                desc: "The Burning Platform & Urgency",
                cards: [
                    { q: "What is 'Permacrisis'?", a: "A state of persistent instability (War, Energy, Supply) where static processes fail because variables change constantly.", tags: ["Strategy & Mindset", "Market Context"] },
                    { q: "Sick Man of Europe Stat", a: "Germany ranks 18th of 21 industrial economies (ZEW). Competitiveness is lost due to a 'Digital Lag'.", tags: ["Market Context", "Strategy & Mindset"] },
                    { q: "Shock Digitalization", a: "The argument that incremental pilots are too slow. Radical digital overhaul is needed to prevent de-industrialization.", tags: ["Strategy & Mindset", "Technology"] },
                    { q: "The LkSG 'Trojan Horse'", a: "Using Supply Chain Act compliance to force deep-tier visibility, creating the backbone for a DCE.", tags: ["Supply Chain (APS)", "Market Context"] },
                    { q: "The Tech Triad", a: "<b>1. IIoT/5G:</b> Nervous System.<br><b>2. Big Data:</b> Brain.<br><b>3. GenAI:</b> Accelerator.", tags: ["Technology", "AI & Future"] }
                ]
            },
            {
                title: "2. Psychology & Culture",
                desc: "Navigating the Mindset Gap",
                cards: [
                    { q: "What is 'Angststillstand'?", a: "Fear-induced stagnation. CEOs paralyzed between today's crises and tomorrow's AI.", tags: ["Strategy & Mindset", "Sales Tactics"] },
                    { q: "Burger vs. D√∂ner", a: "<b>US (Burger):</b> Start now, fix later (Winning).<br><b>EU (D√∂ner):</b> Plan to end, avoid error (Fear of Losing).", tags: ["Strategy & Mindset", "Market Context"] },
                    { q: "The Poet (Archetype)", a: "Reflects on meaning. Needs narrative and context before acting.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "The Thinker (Archetype)", a: "Analyzes risks. Demands 100% accuracy. Prone to paralysis.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "The Doer (Archetype)", a: "Executes immediately. Our goal: Use data to give the 'Thinker' the courage to become a 'Doer'.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "Trust Pyramid", a: "Base: Empathy. Middle: Authority. Top: Partnership.", tags: ["Sales Tactics", "Strategy & Mindset"] }
                ]
            },
            {
                title: "3. Solution Architecture",
                desc: "The DCE Engine",
                cards: [
                    { q: "The Great Synergy", a: "<b>Logility:</b> Strategic Eye (Plan).<br><b>Germanedge:</b> Operational Hand (Execute).", tags: ["Technology", "Supply Chain (APS)"] },
                    { q: "What is Edge.One?", a: "A PaaS Integration Hub (Unified Production Workplace) connecting ERP, SCADA, and Apps.", tags: ["Technology", "Manufacturing (MES)"] },
                    { q: "Pillar 1: Speed", a: "Reducing concept-to-cash cycle. Removing decision latency.", tags: ["ROI & Value", "Strategy & Mindset"] },
                    { q: "Pillar 2: Flexibility", a: "Modular consistency. Reconfiguring lines overnight without breaking the system.", tags: ["Technology", "Manufacturing (MES)"] },
                    { q: "Pillar 3: Resilience", a: "Absorbing shocks (cyber/supply) via security-by-design and prediction.", tags: ["ROI & Value", "Supply Chain (APS)"] },
                    { q: "Pillar 4: Courage", a: "Using predictive certainty to lower the risk threshold for bold decisions.", tags: ["Strategy & Mindset", "ROI & Value"] }
                ]
            },
            {
                title: "4. Sales Playbook",
                desc: "Winning Tactics",
                cards: [
                    { q: "Beating SAP", a: "<b>Accountant vs. Engineer.</b> SAP runs the office (Finance). We run the factory (Ops).", tags: ["Competition", "Sales Tactics"] },
                    { q: "ZF Lesson: Phase Mismatch", a: "Stop 'Vision Selling' when the customer is in 'Evaluation' mode. Map features to spreadsheets.", tags: ["Sales Tactics"] },
                    { q: "Hidden Stakeholder", a: "Create a 5-min video reel for executives who vote but never attend demos.", tags: ["Sales Tactics"] },
                    { q: "Customer Intimacy Platform", a: "A portal for existing customers. Use search data to detect upsell signals.", tags: ["Sales Tactics", "Technology"] },
                    { q: "Flow Economy Formula", a: "(Speed + Flexibility + Resilience) √ó Courage = Flow Economy", tags: ["Strategy & Mindset", "ROI & Value"] }
                ]
            },
            {
                title: "5. Technical Roadmap",
                desc: "Implementation Journey",
                cards: [
                    { q: "Stage 1: Connectivity", a: "Goal: Visibility. Implement IIoT/5G to see what is happening.", tags: ["Technology", "Manufacturing (MES)"] },
                    { q: "Stage 2: Analytics", a: "Goal: Understanding. Aggregate data to know WHY it happened.", tags: ["Technology", "AI & Future"] },
                    { q: "Stage 3: Prediction", a: "Goal: Foresight. DCE Core. AI predicts failures before they occur.", tags: ["AI & Future", "ROI & Value"] },
                    { q: "Stage 4: Autonomous Flow", a: "Goal: Autonomy. Self-optimizing lines. Human strategy only.", tags: ["AI & Future", "Manufacturing (MES)"] },
                    { q: "Cybersecurity", a: "We secure the decision loop. Segregating OT networks from public internet.", tags: ["Technology", "Security"] }
                ]
            },
            {
                title: "6. Brand Identity",
                desc: "Tone of Voice",
                cards: [
                    { q: "Brand Promise", a: "In the moment of truth, empowering you to take the right decision.", tags: ["Strategy & Mindset"] },
                    { q: "Tone of Voice", a: "The 'Professional Provocateur'. Reliable but challenging the status quo.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "Brand Architecture", a: "'Germanedge is an Aptean company.' Combine German agility with US scale.", tags: ["Strategy & Mindset", "Competition"] },
                    { q: "Key Message", a: "'Germany, Stop Whining!' - Move from analysis to action.", tags: ["Sales Tactics", "Strategy & Mindset"] }
                ]
            },
            // TRACK 2: DIGITAL FACTORY INTEL
            {
                title: "7. Portfolio & Factory 0",
                desc: "The Disruptive Offer",
                cards: [
                    { q: "The 4 Pillars", a: "1. MES (GEFASOFT)<br>2. Planning (ORSOFT)<br>3. Quality (QDA)<br>4. Worker (New Solutions)", tags: ["Technology", "Manufacturing (MES)"] },
                    { q: "Factory 0 Concept", a: "Pre-defined end-to-end processes for immediate value. Zero setup time.", tags: ["Manufacturing (MES)", "ROI & Value"] },
                    { q: "Speed USP", a: "Deployment in <b>under 10 minutes</b> vs traditional months.", tags: ["ROI & Value", "Competition"] },
                    { q: "App Composer", a: "Low-code capability for 2-week agile enhancement cycles.", tags: ["Technology", "Workforce"] },
                    { q: "Target Matrix", a: "<b>Regions:</b> DACH & Nordics.<br><b>Industries:</b> Auto, Pharma, Electronics.", tags: ["Market Context", "Sales Tactics"] }
                ]
            },
            {
                title: "8. MES Landscape",
                desc: "GEFASOFT Domain",
                cards: [
                    { q: "Top Incumbents", a: "Siemens, Rockwell, SAP. Strengths: Scale. Weakness: Monolithic/Slow.", tags: ["Competition", "Manufacturing (MES)"] },
                    { q: "The Disruptor", a: "<b>Tulip:</b> No-code platform. Wins on agility and ease of use.", tags: ["Competition", "Technology"] },
                    { q: "Cloud Trend", a: "Cloud MES growing to $24B by 2031. Driven by multi-site scalability.", tags: ["Market Context", "Technology"] },
                    { q: "AI in MES", a: "Predictive Maintenance & Quality are now standard requirements.", tags: ["AI & Future", "Manufacturing (MES)"] },
                    { q: "Our Positioning", a: "'End-to-End, Yet Modular'. Integrated platform vs point solutions.", tags: ["Competition", "Strategy & Mindset"] }
                ]
            },
            {
                title: "9. Supply Chain Planning",
                desc: "ORSOFT Domain",
                cards: [
                    { q: "The Leaders", a: "Kinaxis, o9 Solutions, Blue Yonder. (Gartner Magic Quadrant).", tags: ["Competition", "Supply Chain (APS)"] },
                    { q: "The Unicorn", a: "<b>o9 Solutions:</b> The 'Digital Brain'. Growing fast via Graph tech.", tags: ["Competition", "AI & Future"] },
                    { q: "AI Forecasting", a: "Demand sensing using external data (weather, trends) vs historic data.", tags: ["AI & Future", "Supply Chain (APS)"] },
                    { q: "Integration Edge", a: "ORSOFT's deep certification inside SAP. No separate data silo needed.", tags: ["Competition", "Technology"] },
                    { q: "Startup Agility", a: "New players (Relex, Pigment) win on speed (Weeks vs Months implementation).", tags: ["Competition", "ROI & Value"] }
                ]
            },
            {
                title: "10. Quality & LIMS",
                desc: "QDA Domain",
                cards: [
                    { q: "The Old Guard", a: "ETQ, MasterControl, TrackWise. Reliable but heavy/expensive.", tags: ["Competition", "Quality (QMS)"] },
                    { q: "Predictive Quality", a: "The shift from 'inspecting defects out' to 'predicting them away' with AI.", tags: ["Quality (QMS)", "AI & Future"] },
                    { q: "Phantom of Heilbronn", a: "Story hook: High cost of lab failure (DNA contamination case).", tags: ["Story", "Quality (QMS)"] },
                    { q: "LIMS Disruptors", a: "Benchling & Labguru. Modern, R&D focused, cloud-native.", tags: ["Competition", "Quality (QMS)"] },
                    { q: "Regulatory Drivers", a: "EU MDR & FDA 21 CFR Part 11 are major sales catalysts.", tags: ["Market Context", "Quality (QMS)"] }
                ]
            },
            {
                title: "11. Connected Worker",
                desc: "New Solutions Domain",
                cards: [
                    { q: "EAM Market Leader", a: "IFS (#1 Market Share). Focus on Asset Lifecycle.", tags: ["Competition", "Workforce"] },
                    { q: "Consumer-App Threat", a: "MaintainX & UpKeep. Winning because workers actually like the UX.", tags: ["Competition", "Workforce"] },
                    { q: "Demographic Gap", a: "Capturing tribal knowledge from retiring workers for the next gen.", tags: ["Workforce", "Market Context"] },
                    { q: "The Integrated USP", a: "A checklist app fails without MES integration. We connect the worker to the machine.", tags: ["Workforce", "Technology"] },
                    { q: "ROI Logic", a: "Reducing shift handover times by 50%.", tags: ["ROI & Value", "Workforce"] }
                ]
            },
            {
                title: "12. Strategy & OKRs",
                desc: "Execution Targets",
                cards: [
                    { q: "Enterprise Strategy", a: "Sell Scalability, Security, and 'Transformation Partner' status.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "Mid-Market Strategy", a: "Sell 'Turnkey Cloud', Low TCO, and Quick Wins.", tags: ["Sales Tactics", "ROI & Value"] },
                    { q: "Trojan Horse", a: "Use LkSG (Supply Chain Act) compliance to sell the platform.", tags: ["Sales Tactics", "Market Context"] },
                    { q: "Objective: DACH", a: "Win 5 new enterprise customers in target sectors by 2025.", tags: ["Sales Tactics", "Market Context"] },
                    { q: "Objective: Innovation", a: "Release 4 new AI-powered features by 2025.", tags: ["AI & Future", "Technology"] }
                ]
            },
            // TRACK 3: AI ADOPTION
            {
                title: "13. The Centaur Mindset",
                desc: "Human-Centric AI & Symbiosis",
                cards: [
                    { q: "What is the 'Centaur Model' in AI?", a: "A hybrid collaboration model where humans (Strategic Direction/Creativity) and AI (Data Processing/Speed) combine strengths to outperform either alone.", tags: ["AI & Future", "Strategy & Mindset"] },
                    { q: "\"AI relieves you from work, not from...\"", a: "<b>\"...Thinking.\"</b> The human remains the \"Pilot\" responsible for critical judgment, context, and final quality control.", tags: ["AI & Future", "Workforce"] },
                    { q: "What is 'AI Triangulation'?", a: "Using multiple different AI models (e.g., ChatGPT + Claude + Perplexity) to compare perspectives and validate results, like a board of advisors.", tags: ["AI & Future", "Technology"] },
                    { q: "The Core Human Role in the Centaur Model", a: "<b>Quality Control & Direction.</b> The human must set the context (Prompting) and rigorously evaluate the AI's output (Editing).", tags: ["AI & Future", "Workforce"] },
                    { q: "Iterative Workflow Principle", a: "The best results come from a \"Ping-Pong\" dialogue: Human Draft -> AI Critique -> Human Refinement -> AI Polish.", tags: ["AI & Future", "Workforce"] },
                    { q: "Why is 'Prompt Engineering' a social skill?", a: "Because it requires empathy and clear communication context, similar to onboarding a highly intelligent but literal-minded human intern.", tags: ["AI & Future", "Workforce"] }
                ]
            },
            {
                title: "14. AI as a Social Partner",
                desc: "Overcoming Social Friction",
                cards: [
                    { q: "The \"Invisible Assistant\" Ideal", a: "AI should function like a \"Digital Shadow\" or \"Prompter in a Theater\"‚Äîalways present and helpful, but never dominating the stage.", tags: ["AI & Future", "Workforce"] },
                    { q: "\"Human-in-Control\" Principle", a: "The psychological necessity that humans must always feel they can intervene and steer the AI, reducing stress and rejection.", tags: ["AI & Future", "Psychology"] },
                    { q: "The \"Polarity Map\" of Team AI", a: "Teams must balance two poles: **Efficiency/Control** (AI Automation) vs. **Exploration/Learning** (Human Creativity). Both are needed.", tags: ["AI & Future", "Strategy & Mindset"] },
                    { q: "Neuroscience of AI Adoption", a: "\"Visible\" automation can trigger threat responses (Cortisol). \"Invisible/Supportive\" automation triggers trust (Oxytocin).", tags: ["AI & Future", "Psychology"] },
                    { q: "Artificial Colleagues vs. Tools", a: "Moving from viewing AI as a \"Calculator\" to viewing it as a \"Team Member\" (e.g., An Artificial Expert for Quality or an Artificial Challenger for Strategy).", tags: ["AI & Future", "Strategy & Mindset"] },
                    { q: "The Cultural Catalyst Effect", a: "AI forces teams to ask \"Who are we?\" and \"What is our purpose?\", acting as a mirror that accelerates cultural transformation.", tags: ["AI & Future", "Strategy & Mindset"] }
                ]
            },
            {
                title: "15. Leadership in the Age of Speed",
                desc: "Dromology & Resonance",
                cards: [
                    { q: "What is 'Dromology'?", a: "The study of speed (derived from *dromos*). It posits that speed is the primary engine of modern power and societal change.", tags: ["Strategy & Mindset", "Market Context"] },
                    { q: "The Danger of \"Rasender Stillstand\"", a: "<b>\"Frenzied Standstill.\"</b> A state where high-speed activity (Frantic AI loops) leads to a loss of meaning and no actual progress.", tags: ["Strategy & Mindset", "Psychology"] },
                    { q: "What are \"Resonance Spaces\" (Resonanzr√§ume)?", a: "Deliberate pauses or \"slow zones\" created by leaders to allow teams to digest information and reflect, counteracting the speed of AI.", tags: ["Strategy & Mindset", "Leadership"] },
                    { q: "The Paradox of Acceleration", a: "As AI accelerates information flow, the *time* available for human decision-making shrinks, increasing the risk of \"Decision Paralysis.\"", tags: ["Strategy & Mindset", "AI & Future"] },
                    { q: "The \"Sprint & Pause\" Rhythm", a: "A leadership strategy: Alternate between high-speed AI execution sprints and slow, human-centric reflection phases.", tags: ["Strategy & Mindset", "Leadership"] },
                    { q: "Speed as a Power Factor", a: "In a Dromological organization, power belongs to those who control the *tempo* of information, not just the content.", tags: ["Strategy & Mindset", "Market Context"] }
                ]
            },
            {
                title: "16. Strategic Execution",
                desc: "Culture, Governance & KPIs",
                cards: [
                    { q: "The \"Scaling Gap\" Statistic", a: "74% of companies fail to scale AI beyond the pilot phase. The barrier is rarely technology, but **Culture and Governance**.", tags: ["Strategy & Mindset", "AI & Future"] },
                    { q: "Leadership Formula for AI", a: "<b>Leadership = Technology √ó Culture.</b> You cannot buy adoption; you must cultivate the social acceptance of the tool.", tags: ["Strategy & Mindset", "Leadership"] },
                    { q: "The \"Early vs. Late\" Risk", a: "Investing too early is expensive (learning curve). Investing too late is dangerous (market irrelevance). The sweet spot is \"Strategic Exploration.\"", tags: ["Strategy & Mindset", "ROI & Value"] },
                    { q: "Types of AI Integration", a: "1. **Embedded:** Invisible (e.g., Spam filter). 2. **Copilot:** Collaborative (e.g., Coding assistant). 3. **Agent:** Autonomous (e.g., Auto-booking).", tags: ["AI & Future", "Technology"] },
                    { q: "The \"Social Competence\" Bias", a: "The risk that employees using AI are perceived as \"lazy\" or \"less competent.\" Leaders must reframe AI usage as \"Smart Leverage.\"", tags: ["Psychology", "Workforce"] },
                    { q: "Strategic KPI for AI", a: "Don't just measure \"Time Saved.\" Measure \"Quality Gained\" and \"Employee Satisfaction\" (Trust in the tool).", tags: ["ROI & Value", "AI & Future"] }
                ]
            },
            {
                title: "17. Social Interaction",
                desc: "Defining AI Roles",
                cards: [
                    { q: "AI Role: Experts", a: "AI acting as a deep-domain specialist (e.g., Legal, Code, Medicine) available on demand to answer complex queries.", tags: ["AI & Future", "Workforce"] },
                    { q: "AI Role: Colleagues", a: "AI working alongside humans on daily tasks (\"Co-Pilot\"), handling the repetitive load while the human guides the workflow.", tags: ["AI & Future", "Workforce"] },
                    { q: "AI Role: Decision Makers", a: "AI taking over specific autonomous decisions based on data thresholds (e.g., automated stock reordering), freeing humans for strategic choices.", tags: ["AI & Future", "Automation"] },
                    { q: "AI Role: Discussion Partners", a: "AI acting as a \"Sparring Partner\" or \"Devil's Advocate\" to challenge human assumptions and refine ideas through dialogue.", tags: ["AI & Future", "Workforce"] }
                ]
            },
            // TRACK 4: COMPETITIVE MASTERY
            {
                title: "18. The Factory 0 Disruption",
                desc: "Tech Advantage & Speed",
                cards: [
                    { q: "What is the 'Factory 0' Concept?", a: "Pre-defined end-to-end processes allowing immediate value and zero setup time. A 'Factory in a Box' approach.", tags: ["Manufacturing (MES)", "Technology"] },
                    { q: "The '10-Minute' Promise", a: "The ability to deploy a digital factory module in minutes, not months. A bold claim that proves true agility against legacy MES.", tags: ["ROI & Value", "Technology"] },
                    { q: "The Enabler: App Composer", a: "Low-code capability allowing customers to enhance processes in 2-week Scrum cycles without heavy IT dependency.", tags: ["Technology", "Workforce"] },
                    { q: "Target Audience Positioning", a: "<b>Mid-Market:</b> Needs 'Turnkey' solutions.<br><b>Enterprise:</b> Needs 'Agility' to pivot fast.", tags: ["Sales Tactics", "Market Context"] },
                    { q: "The Competitive Wedge", a: "We beat Legacy on <b>Speed</b> (minutes vs months). We beat Startups on <b>Completeness</b> (full suite vs apps).", tags: ["Competition", "Strategy & Mindset"] },
                    { q: "The Market Trend", a: "Cloud MES is skyrocketing. The market is projected to reach <b>$24 Billion by 2031</b>.", tags: ["Market Context", "Manufacturing (MES)"] }
                ]
            },
            {
                title: "19. Battling the Giants",
                desc: "Enterprise Strategy (SAP/Siemens)",
                cards: [
                    { q: "The Opponents", a: "<b>Siemens, Rockwell, SAP.</b> Strengths: Brand & Scale. Weaknesses: Monolithic, slow, and 'Aging Architectures'.", tags: ["Competition", "Market Context"] },
                    { q: "The 'Silo' Argument", a: "Buying point solutions creates data silos. We offer a unified spine (Edge.One) versus fragmented tools.", tags: ["Sales Tactics", "Technology"] },
                    { q: "The Integration Advantage", a: "<b>Data Convergence.</b> A quality issue in QDA automatically adjusts the schedule in ORSOFT‚Äîa seamless loop.", tags: ["Technology", "Supply Chain (APS)"] },
                    { q: "Countering the 'Suite' Pitch", a: "Big vendors offer suites but they are cobbled together acquisitions. Edge.One is 'End-to-End, Yet Modular'.", tags: ["Sales Tactics", "Competition"] },
                    { q: "The 'Risk' Neutralizer", a: "Leverage <b>Aptean's global backing</b> + ISO 27001 compliance. We have the stability of a giant with the speed of a startup.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "Winning on Agility", a: "Enterprises are stuck with static systems. Our 2-week innovation cycles mean they are never obsolete.", tags: ["ROI & Value", "Technology"] }
                ]
            },
            {
                title: "20. Crushing the Startups",
                desc: "Mid-Market Strategy (Tulip/MaintainX)",
                cards: [
                    { q: "The Opponents", a: "<b>Tulip, MaintainX, o9.</b> Strengths: Modern UI & Speed. Weaknesses: Lack of breadth & long-term stability.", tags: ["Competition", "Startups"] },
                    { q: "The 'App Fatigue' Trap", a: "Startups offer fragmented tools (just checklists, just planning). We offer a platform that grows with you.", tags: ["Sales Tactics", "Technology"] },
                    { q: "The 'Risk' Argument", a: "Startups are 'Here today, gone tomorrow.' Germanedge offers modern SaaS tech backed by decades of domain stability.", tags: ["Sales Tactics", "Strategy & Mindset"] },
                    { q: "The Pricing Strategy", a: "<b>GermanedgeNOW.</b> A SaaS/Marketplace model that lowers upfront costs, making us accessible to the 'Mittelstand'.", tags: ["Sales Tactics", "ROI & Value"] },
                    { q: "Domain Expertise Difference", a: "Startups have cool tech but shallow logic. We have deep manufacturing logic (GEFASOFT/ORSOFT) wrapped in new tech.", tags: ["Competition", "Manufacturing (MES)"] },
                    { q: "The Mid-Market Pitch", a: "\"Enterprise Power at Mid-Market Cost.\" You don't need to be BMW to run a BMW-grade system.", tags: ["Sales Tactics", "Strategy & Mindset"] }
                ]
            },
            {
                title: "21. ROI & Financial Selling",
                desc: "The CFO Pitch & Metrics",
                cards: [
                    { q: "The Strategy Pivot", a: "Stop selling features. Start selling <b>Outcomes</b>. Moving from 'Technical Feasibility' to 'Financial Transparency'.", tags: ["Sales Tactics", "ROI & Value"] },
                    { q: "Key Metric: Payback Period", a: "Target ROI in <b>< 1.5 Years</b> (vs industry avg 2.5 years for legacy MES projects).", tags: ["ROI & Value", "Manufacturing (MES)"] },
                    { q: "Key Metric: Inventory", a: "Our APS can cut inventory holding costs by <b>15%</b>, freeing millions in working capital.", tags: ["ROI & Value", "Supply Chain (APS)"] },
                    { q: "Key Metric: Throughput", a: "Mid-sized plants increased throughput by <b>5-10%</b> without buying new machines, just by optimizing flow.", tags: ["ROI & Value", "Manufacturing (MES)"] },
                    { q: "Key Metric: Efficiency", a: "Reducing shift handover times by <b>50%</b> using the Digital Shift Book (New Solutions).", tags: ["ROI & Value", "Workforce"] },
                    { q: "Key Metric: OEE", a: "LNS Research data shows Digital Lean tools drive <b>10-20%</b> improvement in OEE (Overall Equipment Effectiveness).", tags: ["ROI & Value", "Manufacturing (MES)"] }
                ]
            },
            {
                title: "22. Sales Narratives",
                desc: "Storytelling for Sales",
                cards: [
                    { q: "The 'Phantom of Heilbronn'", a: "<i>The Quality Story.</i> A police hunt for a serial killer turned out to be contaminated cotton swabs. <b>Lesson: Quality data integrity is everything.</b>", tags: ["Story", "Quality (QMS)"] },
                    { q: "The '10-Minute Factory'", a: "<i>The Speed Story.</i> Imagine setting up a full digital factory before you finish your coffee. That is the new standard we set.", tags: ["Story", "Manufacturing (MES)"] },
                    { q: "The 'Safe Bet' Trap", a: "<i>The Innovation Story.</i> \"Nobody gets fired for buying Siemens\"... until the factory closes because it couldn't adapt fast enough.", tags: ["Story", "Competition"] },
                    { q: "The 'Excel House of Cards'", a: "<i>The Planning Story.</i> One wrong formula in a spreadsheet can cost millions in stockouts. Why run a ‚Ç¨50M plant on a ‚Ç¨100 tool?", tags: ["Story", "Supply Chain (APS)"] },
                    { q: "The 'Silo Detective'", a: "<i>The Integration Story.</i> Maintenance blames Production. Production blames Planning. Why? Because they look at different data.", tags: ["Story", "Technology"] },
                    { q: "The 'Centaur' Future", a: "<i>The AI Story.</i> AI doesn't replace the worker; it gives them superpowers. Be the Pilot, not the Passenger.", tags: ["Story", "AI & Future"] }
                ]
            }
        ];

        // --- QUIZ DATA ---
        const quizzes = {
            'strategy': {
                questions: [
                    { q: "What is 'Permacrisis'?", answers: ["A temporary recession", "A state of persistent instability", "A software bug"], correct: 1 },
                    { q: "What is the primary psychological barrier for German CEOs?", answers: ["Arrogance", "Angststillstand (Fear-induced stagnation)", "Lack of budget"], correct: 1 },
                    { q: "What is the key differentiator of Edge.One?", answers: ["It is the cheapest option", "It connects ERP, SCADA, and Apps (PaaS)", "It is only for automotive"], correct: 1 }
                ]
            },
            'intel': {
                questions: [
                    { q: "What is the 'Factory 0' concept?", answers: ["A factory with no workers", "Pre-defined end-to-end processes for zero setup time", "A factory with zero emissions"], correct: 1 },
                    { q: "Who is the main disruptor in the MES space?", answers: ["SAP", "Tulip", "Oracle"], correct: 1 },
                    { q: "What is the ROI logic for the Connected Worker?", answers: ["Reducing shift handover times by 50%", "Replacing all workers with robots", "Cheaper coffee in the breakroom"], correct: 0 }
                ]
            },
            'ai': {
                questions: [
                    { q: "What is the 'Centaur Model'?", answers: ["AI replacing humans", "Human creativity + AI speed working together", "A mythical creature strategy"], correct: 1 },
                    { q: "What is 'Dromology'?", answers: ["The study of drones", "The study of speed as power", "A new coding language"], correct: 1 },
                    { q: "What is the core human role in the AI era?", answers: ["Data entry", "Quality Control & Direction", "Coffee fetching"], correct: 1 }
                ]
            },
            'comp': {
                questions: [
                    { q: "How fast can the Digital Factory be deployed?", answers: ["6 Months", "10 Minutes", "2 Weeks"], correct: 1 },
                    { q: "What is the key weakness of legacy giants like SAP?", answers: ["Too expensive", "Monolithic architectures & slow speed", "Lack of brand awareness"], correct: 1 },
                    { q: "What is the target ROI payback period?", answers: ["5 Years", "< 1.5 Years", "10 Years"], correct: 1 }
                ]
            }
        };

        // --- APP STATE ---
        let currentTrack = null; 
        let currentModuleIndex = 0;
        let quizState = { currentQ: 0, correct: 0, track: '' };
        let activeQuizQuestions = [];
        let allTags = new Set();
        let isTagQuiz = false;

        // --- LOGIC ---
        function init() {
            try {
                updateBadges();
                extractTags();
                renderTagCloud();
                showDashboard();
            } catch (e) {
                console.error("Initialization failed:", e);
                document.getElementById('module-title').innerText = "System Error";
            }
        }

        function extractTags() {
            allTags.clear();
            modules.forEach(mod => {
                mod.cards.forEach(card => {
                    if (card.tags) card.tags.forEach(t => allTags.add(t));
                });
            });
        }

        function renderTagCloud() {
            const container = document.getElementById('tag-cloud');
            const sortedTags = Array.from(allTags).sort();
            
            container.innerHTML = sortedTags.map(tag => `
                <div class="tag-pill" onclick="filterByTag('${tag}')">${tag}</div>
            `).join('');
        }

        function updateBadges() {
            const tracks = ['strategy', 'intel', 'ai', 'comp'];
            tracks.forEach(t => {
                if (localStorage.getItem(`cert_${t}`) === 'true') {
                    const badge = document.getElementById(`badge-${t}`);
                    if (badge) badge.style.display = 'inline-flex';
                }
            });
        }

        function showDashboard() {
            currentTrack = null;
            
            document.querySelectorAll('.track-tab').forEach(el => el.classList.remove('active'));
            document.getElementById('quiz-btn').classList.add('hidden');
            document.getElementById('filter-controls').classList.add('hidden');
            document.getElementById('track-tabs-container').classList.remove('hidden'); 
            
            document.getElementById('module-title').innerText = "Welcome to the Academy";
            document.getElementById('module-desc').innerText = "Choose your learning path below.";

            const grid = document.getElementById('card-grid');
            grid.innerHTML = `
                <div class="dashboard-card" onclick="switchTrack('strategy')">
                    <div class="dash-icon">üöÄ</div>
                    <div class="dash-title">The Rookie</div>
                    <div class="dash-desc">Start here to understand the Strategy & "Why".</div>
                </div>
                <div class="dashboard-card" onclick="switchTrack('comp')">
                    <div class="dash-icon">‚öîÔ∏è</div>
                    <div class="dash-title">The Deal Closer</div>
                    <div class="dash-desc">Jump to competitive battlecards & ROI data.</div>
                </div>
                <div class="dashboard-card" onclick="switchTrack('ai')">
                    <div class="dash-icon">üßô</div>
                    <div class="dash-title">The Futurist</div>
                    <div class="dash-desc">Master AI adoption and new tech trends.</div>
                </div>
                <div class="dashboard-card" onclick="switchTrack('intel')">
                    <div class="dash-icon">üß†</div>
                    <div class="dash-title">The Expert</div>
                    <div class="dash-desc">Deep dive into product pillars and Intel.</div>
                </div>
            `;
            
            renderSidebar(); 
        }

        function switchTrack(track) {
            currentTrack = track;
            
            document.getElementById('filter-controls').classList.add('hidden');
            
            document.querySelectorAll('.track-tab').forEach(el => el.classList.remove('active'));
            if(document.getElementById(`tab-${track}`)) {
                document.getElementById(`tab-${track}`).classList.add('active');
            }

            document.getElementById('track-tabs-container').classList.remove('hidden');
            document.getElementById('quiz-btn').classList.remove('hidden');

            let startIndex = 0;
            if (track === 'strategy') startIndex = 0;
            else if (track === 'intel') startIndex = 6;
            else if (track === 'ai') startIndex = 12;
            else if (track === 'comp') startIndex = 17;

            loadModule(startIndex);
        }

        function filterByTag(tag) {
            document.getElementById('module-title').innerText = `Tag: ${tag}`;
            document.getElementById('module-desc').innerText = `Showing all cards tagged with #${tag}`;
            
            document.getElementById('track-tabs-container').classList.add('hidden');
            document.getElementById('quiz-btn').classList.add('hidden');

            const controlsDiv = document.getElementById('filter-controls');
            controlsDiv.innerHTML = `
                <button onclick="startTagQuiz('${tag}')" class="bg-black text-white text-xs font-bold uppercase px-3 py-1 rounded hover:bg-ge-yellow hover:text-black mr-2">üéì Exam: ${tag}</button>
                <button onclick="clearTagFilter()" class="bg-red-100 text-red-600 text-xs font-bold px-3 py-1 rounded hover:bg-red-200">Clear Filter ‚úï</button>
            `;
            controlsDiv.classList.remove('hidden');

            const grid = document.getElementById('card-grid');
            const matchingCards = [];

            modules.forEach((mod, modIndex) => {
                mod.cards.forEach((card, cardIndex) => {
                    if (card.tags && card.tags.includes(tag)) {
                        matchingCards.push(card);
                    }
                });
            });

            grid.innerHTML = matchingCards.map((card, i) => `
                <div class="flashcard-scene" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div class="flashcard-category">Result ${i + 1}</div>
                            <div class="flashcard-icon">?</div>
                            <p class="flashcard-q">${card.q}</p>
                            <div class="absolute bottom-4 text-xs text-gray-400 uppercase tracking-widest font-bold">Click to Flip</div>
                        </div>
                        <div class="flashcard-back">
                            <div class="flashcard-category text-ge-yellow">Insight</div>
                            <div class="flashcard-icon">!</div>
                            <p class="flashcard-a">${card.a}</p>
                            <div class="card-tags">
                                ${card.tags ? card.tags.map(t => `<span class="card-tag">${t}</span>`).join('') : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function clearTagFilter() {
            if (currentTrack) {
                switchTrack(currentTrack);
            } else {
                showDashboard();
            }
        }

        function renderSidebar() {
            const list = document.getElementById('module-list');
            const select = document.getElementById('mobile-select');
            
            if (!currentTrack) {
                list.innerHTML = `<p class="text-gray-500 text-xs text-center mt-10">Select a journey from the dashboard.</p>`;
                select.innerHTML = `<option>Select a journey...</option>`;
                return;
            }

            let start = 0;
            let end = 6;

            if (currentTrack === 'strategy') { start = 0; end = 6; }
            else if (currentTrack === 'intel') { start = 6; end = 12; }
            else if (currentTrack === 'ai') { start = 12; end = 17; }
            else if (currentTrack === 'comp') { start = 17; end = 22; }
            
            const activeModules = modules.slice(start, end);

            list.innerHTML = activeModules.map((m, i) => {
                const globalIndex = start + i;
                return `
                <div onclick="loadModule(${globalIndex})" id="mod-btn-${globalIndex}" class="module-btn ${globalIndex === currentModuleIndex ? 'active' : ''}">
                    <div class="module-number">${i + 1}</div>
                    <div>
                        <p class="text-sm font-bold">${m.title}</p>
                        <p class="text-[10px] opacity-70">${m.desc}</p>
                    </div>
                </div>
            `}).join('');

            select.innerHTML = activeModules.map((m, i) => `<option value="${start + i}">${m.title}</option>`).join('');
        }

        function loadModule(index) {
            currentModuleIndex = index;
            const mod = modules[index];
            
            if (!mod) {
                console.error("Module not found for index:", index);
                return;
            }
            
            document.getElementById('module-title').innerText = mod.title;
            document.getElementById('module-desc').innerText = mod.desc;

            renderSidebar();

            const grid = document.getElementById('card-grid');
            grid.innerHTML = mod.cards.map((card, i) => `
                <div class="flashcard-scene" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div class="flashcard-category">Card ${i + 1}</div>
                            <div class="flashcard-icon">?</div>
                            <p class="flashcard-q">${card.q}</p>
                            <div class="absolute bottom-4 text-xs text-gray-400 uppercase tracking-widest font-bold">Click to Flip</div>
                        </div>
                        <div class="flashcard-back">
                            <div class="flashcard-category text-ge-yellow">Insight</div>
                            <div class="flashcard-icon">!</div>
                            <p class="flashcard-a">${card.a}</p>
                            <!-- TAGS RENDERED HERE -->
                            <div class="card-tags">
                                ${card.tags ? card.tags.map(t => `<span class="card-tag">${t}</span>`).join('') : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- QUIZ FUNCTIONS ---
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startTagQuiz(tag) {
            const taggedCards = [];
            const relatedDistractors = []; 
            const fallbackDistractors = []; 
            
            modules.forEach(mod => {
                mod.cards.forEach(card => {
                    const isTagged = card.tags && card.tags.includes(tag);
                    
                    if (isTagged) {
                        taggedCards.push(card);
                    } else {
                        const hasOverlap = card.tags && card.tags.some(t => t !== tag && taggedCards.length > 0 && taggedCards[0].tags.includes(t));
                        if (hasOverlap) {
                            relatedDistractors.push(card.a);
                        } else {
                            fallbackDistractors.push(card.a);
                        }
                    }
                });
            });

            if (taggedCards.length < 1) return; 

            const shuffledCards = shuffleArray([...taggedCards]);
            const selectedCards = shuffledCards.slice(0, 3);

            activeQuizQuestions = selectedCards.map(card => {
                let possibleDistractors = [...relatedDistractors, ...fallbackDistractors].filter(a => a !== card.a);
                
                const shuffledDistractors = shuffleArray(possibleDistractors);
                const distractors = shuffledDistractors.slice(0, 2);
                
                const answers = shuffleArray([card.a, ...distractors]);
                
                return {
                    q: card.q,
                    answers: answers,
                    correct: answers.indexOf(card.a)
                };
            });

            isTagQuiz = true;
            openQuiz(tag);
        }

        function openQuiz(tagName = null) {
            const modal = document.getElementById('quiz-modal');
            modal.classList.remove('hidden');
            
            document.getElementById('quiz-start').classList.remove('hidden');
            document.getElementById('quiz-questions').classList.add('hidden');
            document.getElementById('quiz-success').classList.add('hidden');
            document.getElementById('quiz-fail').classList.add('hidden');

            if (isTagQuiz && tagName) {
                document.getElementById('quiz-title-display').innerText = `Topic Exam: ${tagName}`;
                document.getElementById('quiz-desc-display').innerText = `Test your knowledge on #${tagName}.`;
            } else {
                document.getElementById('quiz-title-display').innerText = "Track Certification Exam";
                document.getElementById('quiz-desc-display').innerText = "Answer 3 questions correctly to earn your certification badge for this track.";
                isTagQuiz = false; 
            }
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function startQuiz() {
            quizState = { currentQ: 0, correct: 0, track: currentTrack };
            
            if (!isTagQuiz) {
                activeQuizQuestions = quizzes[currentTrack].questions;
                document.getElementById('quiz-track-name').innerText = currentTrack.toUpperCase();
            }

            document.getElementById('quiz-start').classList.add('hidden');
            document.getElementById('quiz-questions').classList.remove('hidden');
            
            renderQuestion();
        }

        function renderQuestion() {
            const qData = activeQuizQuestions[quizState.currentQ];
            document.getElementById('q-current').innerText = quizState.currentQ + 1;
            document.getElementById('q-total').innerText = activeQuizQuestions.length;
            document.getElementById('question-text').innerText = qData.q;

            const container = document.getElementById('answers-container');
            container.innerHTML = qData.answers.map((ans, i) => `
                <button onclick="answerQuestion(${i})" class="w-full text-left p-4 border border-gray-200 rounded hover:bg-gray-50 transition hover:border-black font-medium text-sm">
                    ${ans}
                </button>
            `).join('');
        }

        function answerQuestion(index) {
            const qData = activeQuizQuestions[quizState.currentQ];
            if (index === qData.correct) {
                quizState.correct++;
            }

            quizState.currentQ++;
            if (quizState.currentQ < activeQuizQuestions.length) {
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-questions').classList.add('hidden');
            const total = activeQuizQuestions.length;
            const passed = quizState.correct === total;
            const trackId = isTagQuiz ? `tag_${quizState.track}` : quizState.track;
            
            // Save exam result to Firestore (if logged in)
            if (typeof saveExamResult === 'function' && typeof isLoggedIn === 'function' && isLoggedIn()) {
                saveExamResult(trackId, quizState.correct, total, passed);
                
                if (passed && !isTagQuiz) {
                    saveCertification(trackId, true, quizState.correct).then(() => {
                        // Update progress UI after certification saved
                        if (typeof updateProgressUI === 'function') {
                            updateProgressUI();
                        }
                    });
                }
            }
            
            if (passed) {
                document.getElementById('quiz-success').classList.remove('hidden');
                
                if (!isTagQuiz) {
                    localStorage.setItem(`cert_${quizState.track}`, 'true');
                    updateBadges();
                }
            } else {
                document.getElementById('quiz-fail').classList.remove('hidden');
            }
        }

        function resetQuiz() {
            startQuiz();
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>
    
    <!-- Firebase Auth Integration -->
    <script src="js/auth.js"></script>
</body>
</html>